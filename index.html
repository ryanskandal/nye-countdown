<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>NYE Countdown</title>

    <style>
        :root {
            --accent: #ffffff;
            --accent-glow: rgba(255,255,255,0.4);
        }

        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background: #000;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
        }

        /* ---------- BACKGROUND ---------- */
        #bg {
            position: fixed;
            inset: 0;
            background: url("background.png") center / cover no-repeat;
            animation: bgPulse 10s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%,100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.03); filter: brightness(1.1); }
        }

        /* ---------- COUNTER (BOTTOM CENTER) ---------- */
        #counterBox {
            position: fixed;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.45);
            color: var(--accent);
            padding: 16px 30px;
            border-radius: 20px;
            backdrop-filter: blur(12px);
            text-align: center;
            z-index: 10;
            transition: opacity 0.6s ease;
            box-shadow:
                    0 0 30px var(--accent-glow),
                    0 10px 40px rgba(0,0,0,0.4);
        }

        #counterLabel {
            font-size: 13px;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            opacity: 0.85;
            margin-bottom: 6px;
        }

        #time {
            font-size: clamp(44px, 6vw, 88px);
            font-weight: 900;
            letter-spacing: 0.12em;
            text-shadow:
                    0 0 20px var(--accent-glow),
                    0 6px 30px rgba(0,0,0,0.6);
        }

        /* ---------- FINAL DIGITS (WITH PANEL) ---------- */
        #finalDigits {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            pointer-events: none;
            opacity: 0;
            z-index: 20;
            transition: opacity 0.4s ease;
        }

        #finalDigits .panel {
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(16px);
            padding: 6vh 8vw;
            border-radius: 32px;
            box-shadow:
                    0 0 40px var(--accent-glow),
                    0 20px 60px rgba(0,0,0,0.6);
        }

        #finalDigits .digit {
            font-size: min(60vw, 60vh);
            font-weight: 1000;
            color: var(--accent);
            text-shadow:
                    0 0 40px var(--accent-glow),
                    0 0 100px var(--accent-glow);
            line-height: 1;
        }

        /* ---------- SNOW CANVAS ---------- */
        #snow {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 15;
        }

        /* ---------- FIREWORKS CANVAS ---------- */
        #fx {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 15;
        }


        /* ---------- CHRISTMAS OVERLAY ---------- */
        #christmas {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            z-index: 30;
        }

        #christmas.active {
            opacity: 1;
        }

        #christmas .panel {
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(16px);
            padding: 40px 60px;
            border-radius: 32px;
            box-shadow:
                    0 0 40px var(--accent-glow),
                    0 20px 60px rgba(0,0,0,0.6);
        }

        #christmas h1 {
            font-size: clamp(64px, 10vw, 160px);
            font-weight: 1000;
            color: var(--accent);
            text-align: center;
            text-shadow:
                    0 0 40px var(--accent-glow),
                    0 0 80px var(--accent-glow);
            animation: pop 1s ease forwards;
        }

        @keyframes pop {
            from { transform: scale(0.85); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body>

<div id="bg"></div>
<canvas id="fx"></canvas>

<div id="counterBox">
    <div id="counterLabel">Countdown to 2026</div>
    <div id="time">--:--:--</div>
</div>

<div id="finalDigits">
    <div class="panel">
        <div class="digit"></div>
    </div>
</div>

<div id="christmas">
    <div class="panel">
        <h1>ðŸ¥³ HAPPY NEW YEAR ðŸ¥³</h1>
    </div>
</div>

<script>
    /* ---------- TARGET DATE ---------- */
    function nextChristmas() {
        const now = new Date();
        let t = new Date(now.getFullYear() + 1, 0, 1, 0, 0, 0);
        if (now >= t) t.setFullYear(t.getFullYear() + 1);
        return t;
    }
    let target = nextChristmas();

    /* ---------- COLOR FROM ARTWORK ---------- */
    const img = new Image();
    img.src = "background.png";
    img.onload = () => {
        const c = document.createElement("canvas");
        const ctx = c.getContext("2d");
        c.width = img.width;
        c.height = img.height;
        ctx.drawImage(img, 0, 0);
        const d = ctx.getImageData(0,0,c.width,c.height).data;

        let r=0,g=0,b=0,n=0;
        for(let i=0;i<d.length;i+=40){
            r+=d[i]; g+=d[i+1]; b+=d[i+2]; n++;
        }
        r=Math.floor(r/n); g=Math.floor(g/n); b=Math.floor(b/n);
        document.documentElement.style.setProperty("--accent",`rgb(${r},${g},${b})`);
        document.documentElement.style.setProperty("--accent-glow",`rgba(${r},${g},${b},0.6)`);
    };

    /* ---------- ELEMENTS ---------- */
    const timeEl = document.getElementById("time");
    const labelEl = document.getElementById("counterLabel");
    const counterBox = document.getElementById("counterBox");
    const finalDigits = document.querySelector("#finalDigits .digit");
    const finalDigitsWrap = document.getElementById("finalDigits");
    const christmas = document.getElementById("christmas");

/* ---------- FIREWORKS ---------- */
const fx = document.getElementById("fx"); 
const fctx = fx.getContext("2d");

function resizeFx(){
  fx.width = innerWidth;
  fx.height = innerHeight;
}
resizeFx();
addEventListener("resize", resizeFx);

let fireworks = [];
let particles = [];

class Firework {
  constructor() {
    this.x = Math.random() * fx.width;
    this.y = fx.height;
    this.targetY = Math.random() * fx.height * 0.4 + fx.height * 0.1;
    this.speed = 6 + Math.random() * 3;
    this.color = getComputedStyle(document.documentElement)
      .getPropertyValue("--accent") || "#fff";
  }

  update() {
    this.y -= this.speed;
    if (this.y <= this.targetY) {
      this.explode();
      return false;
    }
    return true;
  }

  draw() {
    fctx.beginPath();
    fctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
    fctx.fillStyle = this.color;
    fctx.fill();
  }

  explode() {
    for (let i = 0; i < 60; i++) {
      particles.push(new Particle(this.x, this.y, this.color));
    }
  }
}

class Particle {
  constructor(x, y, color) {
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 5 + 2;
    this.x = x;
    this.y = y;
    this.vx = Math.cos(angle) * speed;
    this.vy = Math.sin(angle) * speed;
    this.life = 80;
    this.color = color;
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += 0.05; // gravity
    this.life--;
    return this.life > 0;
  }

  draw() {
    fctx.globalAlpha = this.life / 80;
    fctx.beginPath();
    fctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
    fctx.fillStyle = this.color;
    fctx.fill();
    fctx.globalAlpha = 1;
  }
}

function launchFirework() {
  fireworks.push(new Firework());
}

function drawFireworks() {
  fctx.clearRect(0, 0, fx.width, fx.height);

  fireworks = fireworks.filter(fw => {
    fw.draw();
    return fw.update();
  });

  particles = particles.filter(p => {
    p.draw();
    return p.update();
  });

  requestAnimationFrame(drawFireworks);
}

    /* ---------- COUNTDOWN ---------- */
    function tick(){
        const diff = target - new Date();
        const total = Math.floor(diff/1000);

if (total <= 0) {
    finalDigitsWrap.style.opacity = 0;
    christmas.classList.add("active");

    // start fireworks once
    if (!window.__fireworksStarted) {
        window.__fireworksStarted = true;
        drawFireworks();
        setInterval(launchFirework, 600);
    }
    return;
}

        if (total <= 9) {
            counterBox.style.opacity = 0;
            finalDigits.textContent = total;
            finalDigitsWrap.style.opacity = 1;
            return;
        }

        counterBox.style.opacity = 1;
        finalDigitsWrap.style.opacity = 0;

        const h = Math.floor(total/3600);
        const m = Math.floor(total/60)%60;
        const s = total%60;

        timeEl.textContent =
            String(h).padStart(2,"0")+":"+
            String(m).padStart(2,"0")+":"+
            String(s).padStart(2,"0");
    }

    tick();
    setInterval(tick,1000);

    /* ---------- DEV HOTKEY ---------- */
    document.addEventListener("keydown",e=>{
        if(e.key.toLowerCase()==="c"){
            target = new Date(Date.now()+15000);
            labelEl.textContent="Test Mode (15s)";
            labelEl.style.color="#ff5252";
            console.log("ðŸŽ„ Test mode: 15 seconds");
        }
    });
</script>

</body>
</html>
